{% extends "trainer_layout.html" %}

{% block title %}Trainer Dashboard - AKHADA{% endblock %}

{% block trainer_content %}
<header class="mb-8">
    <h1 class="text-3xl font-bold text-neutral-900">Trainer Overview</h1>
    <p class="text-neutral-600">Welcome back, {{ user.name }}.</p>
</header>

<!-- Stats Cards -->
<section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
    
    <div class="bg-white p-6 rounded-xl shadow-lg border border-neutral-200">
        <div class="flex items-center justify-between mb-2">
            <span class="text-sm font-medium text-neutral-500">Active Clients</span>
            <span class="p-2 bg-primary-100 text-primary-600 rounded-lg">
                <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M22 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
            </span>
        </div>
        <p class="text-3xl font-bold text-neutral-900">{{ client_count }}</p>
    </div>
    
    <div class="bg-white p-6 rounded-xl shadow-lg border border-neutral-200">
        <div class="flex items-center justify-between mb-2">
            <span class="text-sm font-medium text-neutral-500">Group Classes</span>
            <span class="p-2 bg-primary-100 text-primary-600 rounded-lg">
                <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.4 14.4 9.6 9.6M18.657 5.343l-1.414-1.414a2 2 0 0 0-2.828 0l-1.414 1.414M11.07 12.93l-1.414 1.414a2 2 0 0 0 0 2.828l1.414 1.414a2 2 0 0 0 2.828 0l1.414-1.414M5.343 18.657l-1.414-1.414a2 2 0 0 1 0-2.828l1.414-1.414M12.93 11.07l1.414-1.414a2 2 0 0 0-2.828-2.828l-1.414 1.414"></path><path d="M2 22 22 2"></path></svg>
            </span>
        </div>
        <p class="text-3xl font-bold text-neutral-900">{{ class_count }}</p>
    </div>
    
    <div class="bg-white p-6 rounded-xl shadow-lg border border-neutral-200">
        <div class="flex items-center justify-between mb-2">
            <span class="text-sm font-medium text-neutral-500">Sessions Today</span>
            <span class="p-2 bg-primary-100 text-primary-600 rounded-lg">
                <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"></rect><line x1="16" x2="16" y1="2" y2="6"></line><line x1="8" x2="8" y1="2" y2="6"></line><line x1="3" x2="21" y1="10" y2="10"></line></svg>
            </span>
        </div>
        <p class="text-3xl font-bold text-neutral-900">{{ sessions_today | length }}</p>
    </div>
    
    <div class="bg-white p-6 rounded-xl shadow-lg border border-neutral-200">
        <div class="flex items-center justify-between mb-2">
            <span class="text-sm font-medium text-neutral-500">Your Rating</span>
            <span class="p-2 bg-primary-100 text-primary-600 rounded-lg">
                <!-- Star Icon -->
                <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>
            </span>
        </div>
        <!-- This is hardcoded for now, just like in your React app -->
        <p class="text-3xl font-bold text-neutral-900">4.9</p>
    </div>
</section>

<!-- Today's Schedule -->
<section class="bg-white p-6 rounded-xl shadow-lg border border-neutral-200">
    <h2 class="text-xl font-semibold text-neutral-900 mb-4">Today's Sessions</h2>
    <div class="space-y-4">
        
        <!-- Jinja loop for today's sessions -->
        {% if sessions_today %}
            {% for session in sessions_today %}
                <div class="flex items-start gap-4 p-4 bg-neutral-50 rounded-lg border border-neutral-200">
                    <div class="p-3 bg-primary-100 rounded-lg">
                        <!-- Clock Icon -->
                        <svg class="w-6 h-6 text-primary-600" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
                    </div>
                    <div class="flex-1">
                        <!-- 
                          *** THIS IS THE FIX ***
                          We are now using the new 'format_isodate' filter
                        -->
                        <p class="text-lg font-semibold text-neutral-900">
                            {{ session.timestamp | format_isodate('%I:%M %p') }}
                        </p>
                        <p class="text-neutral-600">{{ session.session_type or 'Personal Training' }}</p>
                        <!-- 'members' is the related table we joined in app.py -->
                        <p class="text-neutral-500 text-sm">
                            Client: {{ session.members.name if session.members else 'Group Class' }}
                        </p>
                    </div>
                    <span class="px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800">
                        {{ session.session_type or 'Training' }}
                    </span>
                </div>
            {% endfor %}
        {% else %}
            <!-- This shows if there are no sessions today -->
            <div class="text-center py-12 text-neutral-500">
                <svg class="w-12 h-12 mx-auto mb-4 text-neutral-300" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"></rect><line x1="16" x2="16" y1="2" y2="6"></line><line x1="8" x2="8" y1="2" y2="6"></line><line x1="3" x2="21" y1="10" y2="10"></line></svg>
                <h3 class="text-lg font-medium text-neutral-700">No Sessions Today</h3>
                <p>You have no sessions scheduled for the rest of today.</p>
            </div>
        {% endif %}

    </div>
</section>
{% endblock %}